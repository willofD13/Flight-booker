<h1> Book your flight </h1>

<%= form_with model: @booking, data: { 
    controller: "nested-form",
    nested_form_wrapper_selector_value: '.nested-form-wrapper'
    } do |f|%>
    <template data-nested-form-target="template">
                <%= f.fields_for :passengers, Passenger.new, child_index: 'NEW RECORD' do |passengers_form|%>
                    <%= render "passenger_form", f: passengers_form %>
                <% end %>
        </template>
    <div>
        <%= f.hidden_field :flight_id, value: "#{@flight.id}"%>
    </div>
    <div>
        <strong>Departure Airport: </strong>
        <%= @flight.departure_airport.code %>
    </div>
    <div>
        <strong>Arrival Airport: </strong>
        <%= @flight.arrival_airport.code %>
    </div>
    <div>
        <strong>Departure date: </strong>
        <%= @flight.date %>
    </div>
    <div>
        <strong>Departure time: </strong>
        <%= @flight.time.strftime("%H:%m") %>
    </div>
    <div>
        <strong>Flight duration: </strong>
        <%= @flight.duration %>
    </div>
    <div>
        <strong>Number of passengers: </strong>
        <%= @flight.number_of_passengers %>
    </div><br>

    <%= f.fields_for :passengers do |passengers_form|%>
        <%= render "passenger_form", f: passengers_form %>
    <% end %>


    <button type="button" data-action="nested-form#add">Add passenger</button>

    <div data-controller="passengers" data-passengers-number-value="<%= @flight.number_of_passengers%>">
        <div data-passengers-target="form"></div>
        <button type="button" data-action="passengers#renderForm"> Add passenger </button>
        <button type="button" data-action="passengers#deleteForm"> Remove passenger </button>
        <template data-passengers-target="template">
            <div class='fields'>
                <%= f.fields_for :passengers do |passengers_form|%>
                    <%= passengers_form.label :name %>
                    <%= passengers_form.text_field :name%>

                    <%= passengers_form.label :email %>
                    <%= passengers_form.email_field :email%>
                <% end %>
            </div>
        </template>
    </div>
    
    <%= f.submit "Book"%>
<% end %>
